const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./atN2Jykg.js","./QwNgEtIe.js","./DIeogL5L.js","./BKZmce3h.js","./CWj6FrbW.js","./DGaM1_9x.js","./BUwIoTEU.js","./BtNs0uvZ.js","./DU17d604.js","./B8P2podd.js","./bwyIVu-M.js","./FDedg2ZU.js","./CJT487tm.js","./D7ICzF4-.js","./DGVFHOD7.js","./DlV0Rhhi.js","./BT2U62XW.js","./Dric7B_l.js","./TelbXceq.js","./69_IOA4Y.js","./Cbxbsz7q.js","./3JpoygQ7.js","../assets/Table.C_qFjNlq.css","./C0qwNRwb.js","./CfWhJ7d3.js","./CH5d7z7W.js","./YCu01eox.js","./mbYHt68G.js","./D0-wf1hp.js","./BTm594px.js","../assets/CopyIcon.BzeO3Iyt.css","./DWcei-3m.js","./CWNRuWkL.js","./CeVNWETr.js","./DFQwKZDI.js","./B6grDUUQ.js","../assets/SplitIcon.B9I_OPQk.css","./D3HNHyyT.js","./QehizvcT.js","../assets/Select.BRqq_dZN.css","./BENrx8rE.js","./Cpp2hBeD.js","./DPTXRTMs.js","./BNMsK8YA.js","./DIGuKEzC.js","../assets/RadioGroup.BsR68bCM.css","./LNp-1X4U.js","../assets/CopyBtn.BXPkDBDb.css","../assets/ResourceProvider.Dvv_AmZ7.css"])))=>i.map(i=>d[i]);
var b=r=>{throw TypeError(r)};var S=(r,e,t)=>e.has(r)||b("Cannot "+t);var a=(r,e,t)=>(S(r,e,"read from private field"),t?t.call(r):e.get(r)),l=(r,e,t)=>e.has(r)?b("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);import{_ as w}from"./C1FmrZbK.js";import{s as h,g as u,c as g}from"./QwNgEtIe.js";import{K as v,e as R}from"./YCu01eox.js";var f,m,p,k,y;class C{constructor(){l(this,f,h(null));l(this,m,h(!1));l(this,p,h(!1));l(this,k,h(!1));l(this,y,h(""));this.client=null,this.socket=new v(()=>"/kube/ws"),this.socket.on("connected",()=>this.netState="connected"),this.socket.on("reconnect",()=>this.netState="reconnect"),this.socket.on("error",()=>this.netState="error"),this.socket.on("closed",()=>this.netState="closed"),R.on("kubeTunnelReady",async()=>{if(this.toggling){if(this.locked=!1,this.client)return;this.client=await this.socket.getClient(),this.client.on("kubeWatch",e=>{R.emit("resourceUpdate",e)}),console.log("=> All done"),this.toggling=!1,R.emit("tunnelToggleDone"),this.ready=!0}})}get namespace(){return u(a(this,f))}set namespace(e){g(a(this,f),e,!0)}get locked(){return u(a(this,m))}set locked(e){g(a(this,m),e,!0)}get ready(){return u(a(this,p))}set ready(e){g(a(this,p),e,!0)}get toggling(){return u(a(this,k))}set toggling(e){g(a(this,k),e,!0)}get netState(){return u(a(this,y))}set netState(e){g(a(this,y),e,!0)}toggleCluster(){this.toggling||(this.ready=!1,this.toggling=!0,this.locked=!0,this.namespace=null,this.client&&(this.client.dispose(),this.client=null),this.socket.close(),R.emit("resetNamespace"),console.log("=> Reset local cache"))}}f=new WeakMap,m=new WeakMap,p=new WeakMap,k=new WeakMap,y=new WeakMap;const P=new C,D={Deployment:"Deployment",DaemonSet:"DaemonSet",StatefulSet:"StatefulSet",Job:"Job",CronJob:"CronJob",HorizontalPodAutoscaler:"HorizontalPodAutoscaler",Ingress:"Ingress",Service:"Service",Pod:"Pod",Node:"Node",Namespace:"Namespace",PersistentVolume:"PersistentVolume",PersistentVolumeClaim:"PersistentVolumeClaim",StorageClass:"StorageClass",ConfigMap:"ConfigMap",Secret:"Secret",ServiceAccount:"ServiceAccount",Role:"Role",RoleBinding:"RoleBinding",ClusterRole:"ClusterRole",ClusterRoleBinding:"ClusterRoleBinding",Endpoints:"Endpoints",ReplicaSet:"ReplicaSet",Container:"Container",NetworkPolicy:"NetworkPolicy"};class i{constructor(e){this.url=e}async post(e={}){let t=await fetch(this.url,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok?await t.json():{code:1,msg:"error"}}}const E={schema:new i("/kube/schema"),resourceCount:new i("/kube/resource/count"),findRefers:new i("/kube/resource/refers"),findEvents:new i("/kube/resource/events"),importResource:new i("/kube/resource/import"),create:new i("/kube/resource/create"),update:new i("/kube/resource/update"),delete:new i("/kube/resource/delete"),resume:new i("/kube/resource/resume"),pause:new i("/kube/resource/pause"),scaling:new i("/kube/resource/scaling"),rollback:new i("/kube/resource/rollback"),resourceRedeploy:new i("/kube/resource/redeploy")};let d=h(!1),c=null;class V{constructor(){this.schema=null,this.loadPromise=null}async get(){return this.schema?this.schema:(this.loadPromise||(this.loadPromise=E.schema.post().then(({code:e,data:t})=>(this.loadPromise=null,e===0?(this.schema=JSON.parse(t),this.schema):null))),this.loadPromise)}async getKind(e){let t=await this.get();return console.log(t),this.generateK8sDefaultResource(e,{definitions:t})}generateK8sDefaultResource(e,t){const s=this.findDefinitionKeyByKind(e,t);if(!s)throw new Error(`Kind '${e}' not found in schema`);const n=t.definitions[s];if(!n)throw new Error(`Schema definition for '${s}' not found`);return this.generateResourceFromSchema(n,t.definitions)}findDefinitionKeyByKind(e,t){for(const[s,n]of Object.entries(t.definitions))if(n["x-kubernetes-group-version-kind"]&&n["x-kubernetes-group-version-kind"][0].kind===e)return s;return null}generateResourceFromSchema(e,t){const s={};if(e["x-kubernetes-group-version-kind"]){const n=e["x-kubernetes-group-version-kind"][0];s.apiVersion=n.group?`${n.group}/${n.version}`:n.version,s.kind=n.kind}if(e.properties)for(const[n,o]of Object.entries(e.properties))n==="apiVersion"||n==="kind"||(s[n]=this.generatePropertyValue(o,t));return s}generatePropertyValue(e,t){if(e.$ref){const s=e.$ref;if(s.startsWith("#/definitions/")){const n=s.substring(14),o=t[n];if(o)return this.generateResourceFromSchema(o,t)}return{}}switch(e.type){case"string":return e.enum?e.enum[0]:e.format==="date-time"?new Date().toISOString():"";case"number":case"integer":return 0;case"boolean":return!1;case"array":const s=e.items||{};return[this.generatePropertyValue(s,t)];case"object":if(e.properties){const n={};for(const[o,K]of Object.entries(e.properties))n[o]=this.generatePropertyValue(K,t);return n}else if(e.additionalProperties)return{key:this.generatePropertyValue(e.additionalProperties,t)};return{};default:return null}}}class _{constructor(e){this.kinds=e}ready(e){let t=this.kinds.map(()=>!1);this.kinds.forEach((s,n)=>{s.ready(()=>{t[n]=!0,t.filter(o=>o===!1).length===0&&e&&e()})})}}class N{constructor(e){this.list=e,this.kinds=e.map(t=>t.kind),this.resources=null}async getResources(){if(this.resources)return this.resources;let{ResourceKinds:e}=await w(async()=>{const{ResourceKinds:t}=await import("./atN2Jykg.js").then(s=>s.a);return{ResourceKinds:t}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]),import.meta.url);return this.resources=e,e}async _getDependencies(){let e=await this.getResources(),t=[];return this.kinds.map(s=>e[s]).forEach(s=>{s._getDependence().forEach(n=>{t.includes(n)||t.push(n)})}),t}ready(e){P.locked||this._getDependencies().then(t=>{t.forEach(s=>s.keeper.get()),t.find(s=>!s.keeper.done)===void 0&&e&&e()})}wait(e){P.locked||this._getDependencies().then(t=>{t.forEach(s=>s.keeper.get()),t.find(s=>!s.keeper.done)===void 0?e&&e(!0):e&&e(!1)})}getCommonDetailList(){return this.list.map(({name:e,kind:t,namespace:s})=>{let n=this.resources[t].getAllList().find(o=>o.namespace===s&&o.name===e);return n?n.getDetail():null}).filter(e=>!!e)}}const B={schema:new V,withs(...r){return new _(r)},isSupport(r){return!!D[r]},getResourceProvider(r){return new N(r)},_readyResource(){u(d)||w(async()=>{const{ResourceKinds:r}=await import("./atN2Jykg.js").then(e=>e.a);return{ResourceKinds:r}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]),import.meta.url).then(({ResourceKinds:r})=>{c=r,g(d,!0)})},async getResourceKinds(){let{ResourceKinds:r}=await w(async()=>{const{ResourceKinds:e}=await import("./atN2Jykg.js").then(t=>t.a);return{ResourceKinds:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48]),import.meta.url);return r},async kindsReady(r=[],e){this._readyResource(),u(d)&&new _(r.map(t=>c[t])).ready(()=>{let t=new Map;r.forEach(s=>{t.set(s,c[s])}),e&&e(t)})},async ready(r,e){this._readyResource(),u(d)&&c[r].ready(()=>{e&&e(c[r])})},async wait(r,e){this._readyResource(),u(d)&&c[r].wait(t=>{e&&e(t,c[r])})},async waitUtil(r,e){this._readyResource(),u(d)&&c[r].waitUtil(()=>{e&&e(c[r])})},async getKindHandler(r){var t;return(t=(await this.getResourceKinds())[r])==null?void 0:t.getHandler()}};export{E as K,B as R,P as r};
