import"../chunks/CWj6FrbW.js";import{p as Ue,s as n,a as B,h as De,u as L,f as R,e as u,d,c as t,g as e,b as Fe,r as v,t as Je,n as E}from"../chunks/QwNgEtIe.js";import{s as Oe}from"../chunks/DGaM1_9x.js";import{i as g}from"../chunks/B8P2podd.js";import{t as y,a as f,c as me}from"../chunks/DU17d604.js";import{d as je}from"../chunks/BUwIoTEU.js";import{s as He,c as Ke}from"../chunks/DGVFHOD7.js";import{b as Be}from"../chunks/Dric7B_l.js";import{I as U}from"../chunks/QehizvcT.js";import{F as Ee}from"../chunks/BiDRsquW.js";import{p as Ge,h as D,S as qe,f as fe,s as ee}from"../chunks/DPTXRTMs.js";import{S as G}from"../chunks/D3HNHyyT.js";import{R as ze}from"../chunks/DIGuKEzC.js";import{C as Ae}from"../chunks/BENrx8rE.js";import"../chunks/69_IOA4Y.js";import{P as Me,R as Qe}from"../chunks/DWcei-3m.js";import{D as Ve}from"../chunks/CeVNWETr.js";var We=y("<div> </div>"),Xe=y("<!> <!>",1),Ye=y("<!> <!>",1),Ze=y('<div class="title svelte-lph7fi"><a href="/dashboard">Home:</a> Local Proxy <!></div> <div class="line svelte-lph7fi"></div> <div class="section"><div class="sub-title svelte-lph7fi">Basic info</div> <div class="block colum-3"><!> <!> <!></div></div> <div class="section"><div class="sub-title svelte-lph7fi">Service Type</div> <div class="block colum-1"><!></div></div> <div class="section"><div class="sub-title svelte-lph7fi">Select service</div> <div class="block colum-3"><!> <!></div></div> <!>',1),$e=(F,k)=>k(),et=y('<button class="btn"><!> Stop</button>'),tt=(F,k)=>k(),at=y('<button class="btn"><!> Start</button>'),rt=(F,k)=>k(),st=y('<button class="btn"><!> Download Kubeconfig</button>'),lt=y('<div class="top svelte-lph7fi"><!> <div class="buttons svelte-lph7fi"><div class="btn-group"><!> <!> <a class="btn" href="/dashboard"><!> Cancel</a></div></div></div>');function Pt(F,k){Ue(k,!0);let te=n(B([])),m=n(null),J=n(B([])),_=n(null),O=n(B([])),j=n(null),H=n(B([])),K=n(null),ae=null,S=n("service"),q=n(""),z=n(""),A=n(void 0),M=n(void 0),Q=n(void 0),be=n(void 0),x=n(""),b=De(()=>{let a={};return Ge.url.search.substring(1).split("&").forEach(s=>{let[r,p]=s.split("=");a[r]=p}),a}),_e=[{name:"Select a Service",value:"service"},{name:"Select a Pod",value:"pod"},{name:"Service cluster URL",value:"path"},{name:"Use kubectl",value:"kube"}];function he(){e(b).id&&D.startProxyServer(e(b).id)}function ge(){e(b).id&&D.stopProxyServer(e(b).id)}function ye(){e(b).id&&D.downloadKubeconfig(e(b).id)}L(()=>{D.keep().done(()=>{var a,s;if(e(b).id){let r=D.getProxy(e(b).id);t(S,r.serviceType,!0),t(m,r.cluster,!0),t(j,r.service,!0),t(K,r.pod,!0),t(_,r.namespace,!0),t(q,r.name,!0),t(z,r.description,!0),t(A,r.localPort,!0),t(M,(a=r.target)==null?void 0:a.host,!0),t(Q,(s=r.target)==null?void 0:s.port,!0),t(be,e(b).id,!0),t(x,r.status,!0)}})}),L(()=>{qe.keep(fe).done(()=>{t(te,fe.data.map(a=>({name:a.name,value:a.clusterId,type:a.type})),!0)})}),L(async()=>{if(e(m)){let{code:a,body:s}=await ee.post({edgeId:e(m)==="central"?null:e(m),serviceName:"synterix-kube-proxy",path:"/kube/resource/Namespace",headers:{"Content-Type":"application/json;charset=UTF-8"},body:"{}"});if(a===0){let{code:r,data:p}=JSON.parse(s);r===0&&(t(J,p.map(o=>({name:o.metadata.name,value:o.metadata.name})),!0),e(J).length>0&&t(_,e(J)[0].value,!0))}}}),L(async()=>{if(e(_)){let{code:a,body:s}=await ee.post({edgeId:e(m)==="central"?null:e(m),serviceName:"synterix-kube-proxy",path:"/kube/resource/Service",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({namespace:e(_)})});if(a===0){let{code:r,data:p}=JSON.parse(s);r===0&&(t(O,p.map(o=>{var c;return{name:o.metadata.name,value:o.metadata.name,data:{host:o.spec.clusterIP,port:(c=o.spec.ports)==null?void 0:c[0].port}}}),!0),e(O).length>0&&t(j,e(O)[0].value,!0))}}}),L(async()=>{if(e(_)){let{code:a,body:s}=await ee.post({edgeId:e(m)==="central"?null:e(m),serviceName:"synterix-kube-proxy",path:"/kube/resource/Pod",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({namespace:e(_)})});if(a===0){let{code:r,data:p}=JSON.parse(s);r===0&&(t(H,p.map(o=>{var c,i;return{name:o.metadata.name,value:o.metadata.name,data:{host:o.status.podIP,port:(i=(c=o.spec.containers)==null?void 0:c[0].ports)==null?void 0:i[0].containerPort}}}),!0),e(H).length>0&&t(K,e(H)[0].value,!0))}}});var V=lt(),re=d(V);Be(Ee(re,{children:(a,s)=>{var r=Ze(),p=R(r),o=u(d(p),2);{var c=l=>{var P=We(),Y=d(P,!0);v(P),Je(()=>{He(P,1,Ke(["status-text",e(x)==="Running"?"status-active":"status-failed"]),"svelte-lph7fi"),Oe(Y,e(x))}),f(l,P)};g(o,l=>{e(x)&&l(c)})}v(p);var i=u(p,4),I=u(d(i),2),ue=d(I);U(ue,{name:"name",label:"Name",placeholder:"input username",disabled:!0,get value(){return e(q)},set value(l){t(q,l,!0)}});var de=u(ue,2);U(de,{name:"localPort",label:"Local Port",type:"number",placeholder:"input local port",disabled:!0,get value(){return e(A)},set value(l){t(A,l,!0)}});var xe=u(de,2);U(xe,{name:"description",label:"Description",placeholder:"input description",disabled:!0,get value(){return e(z)},set value(l){t(z,l,!0)}}),v(I),v(i);var W=u(i,2),ve=u(d(W),2),Ie=d(ve);ze(Ie,{options:_e,label:"Service Type",direct:"h",disabled:!0,name:"serviceType",get value(){return e(S)},set value(l){t(S,l,!0)}}),v(ve),v(W);var X=u(W,2),ce=u(d(X),2),pe=d(ce);G(pe,{name:"cluster",label:"Cluster",placeholder:"select a cluster",get options(){return e(te)},disabled:!0,get value(){return e(m)},set value(l){t(m,l,!0)}});var Te=u(pe,2);{var Ne=l=>{var P=me(),Y=R(P);{var we=T=>{var N=Xe(),C=R(N);U(C,{name:"host",label:"Host",placeholder:"input host",disabled:!0,get value(){return e(M)},set value(w){t(M,w,!0)}});var Z=u(C,2);U(Z,{name:"port",label:"Port",placeholder:"input port",disabled:!0,get value(){return e(Q)},set value(w){t(Q,w,!0)}}),f(T,N)},Le=T=>{var N=Ye(),C=R(N);G(C,{name:"namespace",label:"Namespace",placeholder:"input username",get options(){return e(J)},disabled:!0,get value(){return e(_)},set value(h){t(_,h,!0)}});var Z=u(C,2);{var w=h=>{G(h,{name:"service",label:"Service",placeholder:"input username",get options(){return e(O)},disabled:!0,get value(){return e(j)},set value($){t(j,$,!0)}})},Re=h=>{G(h,{name:"pod",label:"Pod",placeholder:"input username",get options(){return e(H)},disabled:!0,get value(){return e(K)},set value($){t(K,$,!0)}})};g(Z,h=>{e(S)==="service"?h(w):h(Re,!1)})}f(T,N)};g(Y,T=>{e(S)==="path"?T(we):T(Le,!1)})}f(l,P)};g(Te,l=>{e(S)!=="kube"&&l(Ne)})}v(ce),v(X);var Ce=u(X,2);g(Ce,l=>{}),f(a,r)},$$slots:{default:!0}}),a=>ae=a,()=>ae);var se=u(re,2),le=d(se),oe=d(le);{var ke=a=>{var s=me(),r=R(s);{var p=c=>{var i=et();i.__click=[$e,ge];var I=d(i);Me(I),E(),v(i),f(c,i)},o=c=>{var i=at();i.__click=[tt,he];var I=d(i);Qe(I),E(),v(i),f(c,i)};g(r,c=>{e(x)==="Running"?c(p):c(o,!1)})}f(a,s)};g(oe,a=>{e(x)&&a(ke)})}var ie=u(oe,2);{var Se=a=>{var s=st();s.__click=[rt,ye];var r=d(s);Ve(r),E(),v(s),f(a,s)};g(ie,a=>{e(S)==="kube"&&a(Se)})}var ne=u(ie,2),Pe=d(ne);Ae(Pe),E(),v(ne),v(le),v(se),v(V),f(F,V),Fe()}je(["click"]);export{Pt as component};
