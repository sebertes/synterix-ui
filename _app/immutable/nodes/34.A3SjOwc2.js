import"../chunks/CWj6FrbW.js";import{p as Te,s as o,a as j,u as I,e as n,f as D,d as u,c as t,g as e,b as Ne,r as v,t as Ie,n as ve}from"../chunks/QwNgEtIe.js";import{s as Ce}from"../chunks/DGaM1_9x.js";import{i as H}from"../chunks/B8P2podd.js";import{t as L,a as k,c as Le}from"../chunks/DU17d604.js";import{d as Ue}from"../chunks/BUwIoTEU.js";import{b as we}from"../chunks/Dric7B_l.js";import{I as C}from"../chunks/QehizvcT.js";import{F as Fe}from"../chunks/BiDRsquW.js";import{h as Je,o as ce,p as Oe,S as je,f as de,s as $}from"../chunks/DPTXRTMs.js";import{S as R}from"../chunks/D3HNHyyT.js";import{R as De}from"../chunks/DIGuKEzC.js";import{C as He}from"../chunks/BENrx8rE.js";import{C as Re}from"../chunks/Cpp2hBeD.js";var Ve=L("<!> <!>",1),Be=L("<!> <!>",1),Ee=L('<div class="banner error"> </div>'),Ge=L('<div class="title svelte-is088f"><a href="/dashboard">Home:</a> Create Local Proxy</div> <div class="line svelte-is088f"></div> <div class="section"><div class="sub-title svelte-is088f">Basic info</div> <div class="block colum-3"><!> <!> <!></div></div> <div class="section"><div class="sub-title svelte-is088f">Service Type</div> <div class="block colum-1"><!></div></div> <div class="section"><div class="sub-title svelte-is088f">Select service</div> <div class="block colum-3"><!> <!></div></div> <!>',1),Me=(ee,V)=>V(),qe=L('<div class="top svelte-is088f"><!> <div class="buttons svelte-is088f"><div class="btn-group"><a class="btn" href="/dashboard"><!> Cancel</a> <button class="btn"><!> Update</button></div></div></div>');function lt(ee,V){Te(V,!0);let te=o(j([])),d=o(null),U=o(j([])),p=o(null),S=o(j([])),w=o(null),P=o(j([])),F=o(null),B=o(!1),ae=o(""),J=null,h=o("service"),E=o(""),G=o(""),M=o(void 0),q=o(void 0),z=o(void 0),re=o(void 0);async function pe(){let{result:r,message:c}=await J.validate();if(t(B,!r),t(ae,c,!0),e(B))return;let a=await J.getValue(),{serviceType:s,service:l,pod:O}=a,f={...a,status:"Disconnect",id:e(re)};if(s==="service"){let b=e(S).find(g=>g.value===l);b&&(f.target={...b.data||{}})}else if(s==="pod"){let b=e(P).find(g=>g.value===O);b&&(f.target={...b.data||{}})}else s==="path"&&(f.target={host:a.host,port:a.port});Je.updateProxy(f),await ce.redirect("/dashboard")}let me=[{name:"Select a Service",value:"service"},{name:"Select a Pod",value:"pod"},{name:"Service cluster URL",value:"path"},{name:"Use kubectl",value:"kube"}];I(()=>{let r={};if(Oe.url.search.substring(1).split("&").forEach(c=>{let[a,s]=c.split("=");r[a]=s}),r.id){let a=(ce.getValue("proxies")||[]).find(s=>s.id===r.id);t(h,a.serviceType,!0),t(d,a.cluster,!0),t(w,a.service,!0),t(F,a.pod,!0),t(p,a.namespace,!0),t(E,a.name,!0),t(G,a.description,!0),t(M,a.localPort,!0),t(q,a.target.host,!0),t(z,a.target.port,!0),t(re,r.id,!0)}}),I(()=>{je.keep(de).done(()=>{t(te,de.data.map(r=>({name:r.name,value:r.clusterId,type:r.type})),!0)})}),I(async()=>{if(e(d)){let{code:r,body:c}=await $.post({edgeId:e(d)==="central"?null:e(d),serviceName:"synterix-kube-proxy",path:"/kube/resource/Namespace",headers:{"Content-Type":"application/json;charset=UTF-8"},body:"{}"});if(r===0){let{code:a,data:s}=JSON.parse(c);a===0&&(t(U,s.map(l=>({name:l.metadata.name,value:l.metadata.name})),!0),e(U).length>0&&t(p,e(U)[0].value,!0))}}}),I(async()=>{if(e(p)){let{code:r,body:c}=await $.post({edgeId:e(d)==="central"?null:e(d),serviceName:"synterix-kube-proxy",path:"/kube/resource/Service",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({namespace:e(p)})});if(r===0){let{code:a,data:s}=JSON.parse(c);a===0&&(t(S,s.map(l=>({name:l.metadata.name,value:l.metadata.name,data:{host:l.spec.clusterIP,port:l.spec.ports[0].port}})),!0),e(S).length>0&&t(w,e(S)[0].value,!0))}}}),I(async()=>{if(e(p)){let{code:r,body:c}=await $.post({edgeId:e(d)==="central"?null:e(d),serviceName:"synterix-kube-proxy",path:"/kube/resource/Pod",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({namespace:e(p)})});if(r===0){let{code:a,data:s}=JSON.parse(c);a===0&&(t(P,s.map(l=>({name:l.metadata.name,value:l.metadata.name,data:{host:l.status.podIP,port:l.spec.containers[0].ports[0].containerPort}})),!0),e(P).length>0&&t(F,e(P)[0].value,!0))}}});var A=qe(),se=u(A);we(Fe(se,{children:(r,c)=>{var a=Ge(),s=n(D(a),4),l=n(u(s),2),O=u(l);C(O,{name:"name",label:"Name",placeholder:"input username",get value(){return e(E)},set value(i){t(E,i,!0)}});var f=n(O,2);C(f,{name:"localPort",label:"Local Port",type:"number",placeholder:"input local port",get value(){return e(M)},set value(i){t(M,i,!0)}});var b=n(f,2);C(b,{name:"description",label:"Description",placeholder:"input description",get value(){return e(G)},set value(i){t(G,i,!0)}}),v(l),v(s);var g=n(s,2),oe=n(u(g),2),ge=u(oe);De(ge,{options:me,label:"Service Type",direct:"h",name:"serviceType",get value(){return e(h)},set value(i){t(h,i,!0)}}),v(oe),v(g);var W=n(g,2),ne=n(u(W),2),ue=u(ne);R(ue,{name:"cluster",label:"Cluster",placeholder:"select a cluster",get options(){return e(te)},get value(){return e(d)},set value(i){t(d,i,!0)}});var he=n(ue,2);{var _e=i=>{var _=Le(),X=D(_);{var Se=y=>{var x=Ve(),T=D(x);C(T,{name:"host",label:"Host",placeholder:"input host",get value(){return e(q)},set value(N){t(q,N,!0)}});var Y=n(T,2);C(Y,{name:"port",label:"Port",placeholder:"input port",get value(){return e(z)},set value(N){t(z,N,!0)}}),k(y,x)},Pe=y=>{var x=Be(),T=D(x);R(T,{name:"namespace",label:"Namespace",placeholder:"input username",get options(){return e(U)},get value(){return e(p)},set value(m){t(p,m,!0)}});var Y=n(T,2);{var N=m=>{R(m,{name:"service",label:"Service",placeholder:"input username",get options(){return e(S)},get value(){return e(w)},set value(Z){t(w,Z,!0)}})},xe=m=>{R(m,{name:"pod",label:"Pod",placeholder:"input username",get options(){return e(P)},get value(){return e(F)},set value(Z){t(F,Z,!0)}})};H(Y,m=>{e(h)==="service"?m(N):m(xe,!1)})}k(y,x)};H(X,y=>{e(h)==="path"?y(Se):y(Pe,!1)})}k(i,_)};H(he,i=>{e(h)!=="kube"&&i(_e)})}v(ne),v(W);var ye=n(W,2);{var ke=i=>{var _=Ee(),X=u(_,!0);v(_),Ie(()=>Ce(X,e(ae))),k(i,_)};H(ye,i=>{e(B)&&i(ke)})}k(r,a)},$$slots:{default:!0}}),r=>J=r,()=>J);var le=n(se,2),ie=u(le),K=u(ie),fe=u(K);He(fe),ve(),v(K);var Q=n(K,2);Q.__click=[Me,pe];var be=u(Q);Re(be),ve(),v(Q),v(ie),v(le),v(A),k(ee,A),Ne()}Ue(["click"]);export{lt as component};
