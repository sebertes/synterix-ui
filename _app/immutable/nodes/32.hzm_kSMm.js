import"../chunks/CWj6FrbW.js";import{p as _e,s as v,a as F,u as J,e as l,f as O,d as i,c as t,g as e,b as ye,r as n,t as ge,n as re}from"../chunks/QwNgEtIe.js";import{s as ke}from"../chunks/DGaM1_9x.js";import{i as R}from"../chunks/B8P2podd.js";import{t as N,a as g,c as Se}from"../chunks/DU17d604.js";import{d as xe}from"../chunks/BUwIoTEU.js";import{b as Pe}from"../chunks/Dric7B_l.js";import{I}from"../chunks/QehizvcT.js";import{F as Ce}from"../chunks/BiDRsquW.js";import{h as Ie,o as Ne,S as Te,f as se,s as Q}from"../chunks/DPTXRTMs.js";import{S as j}from"../chunks/D3HNHyyT.js";import{R as Ue}from"../chunks/DIGuKEzC.js";import{U as Le}from"../chunks/YCu01eox.js";import{C as we}from"../chunks/BENrx8rE.js";import{C as Fe}from"../chunks/Cpp2hBeD.js";var Je=N("<!> <!>",1),Oe=N("<!> <!>",1),Re=N('<div class="banner error"> </div>'),je=N('<div class="title svelte-is088f"><a href="/dashboard">Home:</a> Create Local Proxy</div> <div class="line svelte-is088f"></div> <div class="section"><div class="sub-title svelte-is088f">Basic info</div> <div class="block colum-3"><!> <!> <!></div></div> <div class="section"><div class="sub-title svelte-is088f">Service Type</div> <div class="block colum-1"><!></div></div> <div class="section"><div class="sub-title svelte-is088f">Select service</div> <div class="block colum-3"><!> <!></div></div> <!>',1),De=(W,D)=>D(),He=N('<div class="top svelte-is088f"><!> <div class="buttons svelte-is088f"><div class="btn-group"><a class="btn" href="/dashboard"><!> Cancel</a> <button class="btn"><!> Create</button></div></div></div>');function ea(W,D){_e(D,!0);let X=v(F([])),d=v(null),T=v(F([])),f=v(null),k=v(F([])),H=v(null),S=v(F([])),B=v(null),U=v(!1),G=v(""),L=null,x=v("service");async function le(){let{result:r,message:p}=await L.validate();if(t(U,!r),t(G,p,!0),e(U))return;let o=await L.getValue(),{serviceType:s,service:a,pod:w}=o,u={...o,status:"Disconnect",id:Le.getRandomId()};if(s==="service"){let b=e(k).find(h=>h.value===a);b&&(u.target={...b.data||{}})}else if(s==="pod"){let b=e(S).find(h=>h.value===w);b&&(u.target={...b.data||{}})}else s==="path"?u.target={host:o.host,port:o.port}:s==="kube"&&(u.target={});Ie.createProxy(u)?await Ne.redirect("/dashboard"):(t(U,!0),t(G,"Proxy name already exists"))}let oe=[{name:"Select a Service",value:"service"},{name:"Select a Pod",value:"pod"},{name:"Service cluster URL",value:"path"},{name:"Use kubectl",value:"kube"}];J(()=>{Te.keep(se).done(()=>{t(X,se.data.map(r=>({name:r.name,value:r.clusterId,type:r.type})),!0)})}),J(async()=>{if(e(d)){let{code:r,body:p}=await Q.post({edgeId:e(d)==="central"?null:e(d),serviceName:"synterix-kube-proxy",path:"/kube/resource/Namespace",headers:{"Content-Type":"application/json;charset=UTF-8"},body:"{}"});if(r===0){let{code:o,data:s}=JSON.parse(p);o===0&&(t(T,s.map(a=>({name:a.metadata.name,value:a.metadata.name})),!0),e(T).length>0&&t(f,e(T)[0].value,!0))}}}),J(async()=>{if(e(f)){let{code:r,body:p}=await Q.post({edgeId:e(d)==="central"?null:e(d),serviceName:"synterix-kube-proxy",path:"/kube/resource/Service",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({namespace:e(f)})});if(r===0){let{code:o,data:s}=JSON.parse(p);o===0&&(t(k,s.map(a=>({name:a.metadata.name,value:a.metadata.name,data:{host:a.spec.clusterIP,port:a.spec.ports[0].port}})),!0),e(k).length>0&&t(H,e(k)[0].value,!0))}}}),J(async()=>{if(e(f)){let{code:r,body:p}=await Q.post({edgeId:e(d)==="central"?null:e(d),serviceName:"synterix-kube-proxy",path:"/kube/resource/Pod",headers:{"Content-Type":"application/json;charset=UTF-8"},body:JSON.stringify({namespace:e(f)})});if(r===0){let{code:o,data:s}=JSON.parse(p);o===0&&(t(S,s.map(a=>({name:a.metadata.name,value:a.metadata.name,data:{host:a.status.podIP,port:a.spec.containers[0].ports[0].containerPort}})),!0),e(S).length>0&&t(B,e(S)[0].value,!0))}}});var M=He(),Y=i(M);Pe(Ce(Y,{children:(r,p)=>{var o=je(),s=l(O(o),4),a=l(i(s),2),w=i(a);I(w,{name:"name",label:"Name",placeholder:"input username"});var u=l(w,2);I(u,{name:"localPort",label:"Local Port",type:"number",placeholder:"input local port",value:"5959"});var b=l(u,2);I(b,{name:"description",label:"Description",placeholder:"input description"}),n(a),n(s);var h=l(s,2),ee=l(i(h),2),ce=i(ee);Ue(ce,{options:oe,label:"Service Type",direct:"h",name:"serviceType",get value(){return e(x)},set value(c){t(x,c,!0)}}),n(ee),n(h);var z=l(h,2),ae=l(i(z),2),te=i(ae);j(te,{name:"cluster",label:"Cluster",placeholder:"select a cluster",get options(){return e(X)},get value(){return e(d)},set value(c){t(d,c,!0)}});var ve=l(te,2);{var de=c=>{var _=Se(),A=O(_);{var me=y=>{var P=Je(),C=O(P);I(C,{name:"host",label:"Host",placeholder:"input host"});var E=l(C,2);I(E,{name:"port",label:"Port",placeholder:"input port"}),g(y,P)},fe=y=>{var P=Oe(),C=O(P);j(C,{name:"namespace",label:"Namespace",placeholder:"input username",get options(){return e(T)},get value(){return e(f)},set value(m){t(f,m,!0)}});var E=l(C,2);{var be=m=>{j(m,{name:"service",label:"Service",placeholder:"input username",get options(){return e(k)},get value(){return e(H)},set value(K){t(H,K,!0)}})},he=m=>{j(m,{name:"pod",label:"Pod",placeholder:"input username",get options(){return e(S)},get value(){return e(B)},set value(K){t(B,K,!0)}})};R(E,m=>{e(x)==="service"?m(be):m(he,!1)})}g(y,P)};R(A,y=>{e(x)==="path"?y(me):y(fe,!1)})}g(c,_)};R(ve,c=>{e(x)!=="kube"&&c(de)})}n(ae),n(z);var pe=l(z,2);{var ue=c=>{var _=Re(),A=i(_,!0);n(_),ge(()=>ke(A,e(G))),g(c,_)};R(pe,c=>{e(U)&&c(ue)})}g(r,o)},$$slots:{default:!0}}),r=>L=r,()=>L);var Z=l(Y,2),$=i(Z),V=i($),ie=i(V);we(ie),re(),n(V);var q=l(V,2);q.__click=[De,le];var ne=i(q);Fe(ne),re(),n(q),n($),n(Z),n(M),g(W,M),ye()}xe(["click"]);export{ea as component};
